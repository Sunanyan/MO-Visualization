<!DOCTYPE html>
<html>
<head>
    <title>Molecular Orbital Viewer</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="controls">
        <select id="orbitalSelect">
            <option value="mo13a">MO13a (HOMO-1)</option>
            <option value="mo14a">MO14a (HOMO)</option>
            <option value="mo15a">MO15a (LUMO)</option>
            <option value="mo19a">MO19a (LUMO+4)</option>
        </select>
        <input type="number" id="isoval" step="0.01" value="0.05" min="0" max="1">
    </div>

    <script>
        let viewer = null;
        let currentSurface = null;
        
        $(document).ready(function() {
            // 初始化3Dmol viewer
            viewer = $3Dmol.createViewer("container", {
                backgroundColor: 0xffffff,
                defaultZoom: 1.2
            });
            
            // 设置初始轨道
            loadOrbital('mo14a');
            
            // 事件监听
            $('#orbitalSelect').change(function() {
                loadOrbital($(this).val());
            });
            
            $('#isoval').change(function() {
                loadOrbital($('#orbitalSelect').val());
            });
        });

        function loadOrbital(mo) {
            const isoval = parseFloat($('#isoval').val());
            const filename = `orbitals/diene.${mo}.cube`;
            
            // 清除旧数据
            viewer.removeAllSurfaces();
            viewer.clear();
            
            // 加载cube文件
            $.get(filename, function(data) {
                // 添加分子结构
                viewer.addModel(data, "cube");
                viewer.setStyle({}, {sphere: {}});
                
                // 添加轨道表面
                viewer.addSurface($3Dmol.SurfaceType.VDW, {
                    isoval: isoval,
                    color: "green",
                    opacity: 0.7
                });
                
                // 设置视角和渲染
                viewer.zoomTo();
                viewer.render();
            }).fail(function() {
                alert("Failed to load cube file!");
            });
        }
    </script>
</body>
</html>
