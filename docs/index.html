<!DOCTYPE html>
<html>
<head>
    <title>Molecular Orbital Viewer</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    
    <div id="controls">
        <select id="orbitalSelect">
            <option value="mo13a">MO13a (HOMO-1)</option>
            <option value="mo14a">MO14a (HOMO)</option>
            <option value="mo15a">MO15a (LUMO)</option>
            <option value="mo19a">MO19a (LUMO+4)</option>
        </select>
        <input type="number" id="isoval" step="0.01" value="0.05" min="0" max="1">
    </div>

    <script>
        let viewer = null;
        let currentSurface = [];
        
        $(document).ready(function() {
            // 初始化3Dmol viewer
            viewer = $3Dmol.createViewer("container", {
                backgroundColor: 0xffffff,
                defaultZoom: 1.2
            });
            
            // 设置初始轨道
            loadOrbital('mo14a');
            
            // 事件监听
            $('#orbitalSelect').change(function() {
                loadOrbital($(this).val());
            });
            
            $('#isoval').change(function() {
                loadOrbital($('#orbitalSelect').val());
            });
        });

        function loadOrbital(mo) {
            const isoval = parseFloat($('#isoval').val());
            const filename = `orbitals/diene.${mo}.cube`;
            
            // 清除旧数据
            viewer.removeAllSurfaces();
            viewer.clear();
            
            // 加载cube文件
            $.get(filename, function(data) {
                // 添加分子结构（球棍模型）
                viewer.addModel(data, "cube");
                viewer.setStyle({}, {
                    stick: {radius: 0.15},  // 设置键的样式
                    sphere: {               // 设置原子的样式
                        scale: 0.3,         // 原子半径缩放系数
                        colorscheme: {
                            "C": "gray",    // 碳原子颜色
                            "H": "white"    // 氢原子颜色
                        }
                    }
                });
                
                // 添加正相位表面（红色）
                viewer.addSurface($3Dmol.SurfaceType.VOLUME, {
                    isoval: isoval,         // 正等值面
                    color: "red",          // 正相位颜色
                    opacity: 0.7,
                    volscheme: new $3Dmol.Gradient.RWB // 使用红-白-蓝渐变色
                });
                
                // 添加负相位表面（蓝色）
                viewer.addSurface($3Dmol.SurfaceType.VOLUME, {
                    isoval: -isoval,       // 负等值面
                    color: "blue",         // 负相位颜色
                    opacity: 0.7,
                    volscheme: new $3Dmol.Gradient.RWB
                });
                
                // 设置视角和渲染
                viewer.zoomTo();
                viewer.render();
            }).fail(function() {
                alert("无法加载cube文件！");
            });
        }
    </script>
</body>
</html>
